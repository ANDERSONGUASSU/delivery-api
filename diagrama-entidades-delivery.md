# üöÄ Arquitetura da API de Delivery

## üìã Vis√£o Geral
Este documento descreve a arquitetura completa de uma API de delivery, incluindo entidades, servi√ßos, controladores e padr√µes utilizados.

---

## 1Ô∏è‚É£ **Entidades e Heran√ßa (Models + Inheritance)**

### üìä Diagrama de Classes
```mermaid
classDiagram
    title Sistema de Entidades - Heran√ßa e Relacionamentos
    
    %% Classe Base
    class User {
        <<abstract>>
        -Long id
        -String name
        -String email
        -String passwordHash
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        +login() boolean
        +register() boolean
        +updateProfile() void
    }

    %% Entidades Espec√≠ficas
    class Customer {
        -String phone
        -String address
        -String city
        -String state
        +placeOrder(Order) Order
        +viewOrders() List~Order~
        +updateAddress(String) void
    }

    class Restaurant {
        -String taxId
        -String name
        -String description
        -String address
        -String phone
        -Boolean isActive
        +manageMenu() void
        +receiveOrder(Order) void
        +updateStatus(OrderStatus) void
    }

    class Courier {
        -String vehicle
        -String licensePlate
        -String phone
        -CourierStatus status
        -Location currentLocation
        +acceptDelivery(Order) boolean
        +updateStatus(OrderStatus) void
        +updateLocation(Location) void
    }

    %% Entidade de Pedido
    class Order {
        -Long id
        -OrderStatus status
        -BigDecimal totalAmount
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        -LocalDateTime estimatedDelivery
        +updateStatus(OrderStatus) void
        +calculateTotal() BigDecimal
        +isDeliverable() boolean
    }

    %% Relacionamentos de Heran√ßa
    User <|-- Customer : extends
    User <|-- Restaurant : extends
    User <|-- Courier : extends

    %% Relacionamentos de Associa√ß√£o
    Customer "1" --> "0..*" Order : places
    Restaurant "1" --> "0..*" Order : receives
    Courier "0..1" --> "0..*" Order : delivers
```

### üîç **Explica√ß√£o das Entidades:**
- **User**: Classe abstrata base com dados comuns (nome, email, senha)
- **Customer**: Cliente que faz pedidos
- **Restaurant**: Restaurante que recebe e processa pedidos
- **Courier**: Entregador que aceita e entrega pedidos
- **Order**: Pedido central que conecta todas as entidades

---

## 2Ô∏è‚É£ **Camada de Servi√ßos e Controladores**

### üìä Arquitetura de Controllers e Services
```mermaid
classDiagram
    %% Controllers (Camada de Apresenta√ß√£o)
    class CustomerController {
        +POST /customers/orders
        +GET /customers/:id/orders
        +PUT /customers/:id/profile
        +GET /customers/:id/profile
    }
    
    class RestaurantController {
        +GET /restaurants/:id/menu
        +POST /restaurants/:id/orders/:orderId/ack
        +GET /restaurants/:id/orders
        +PUT /restaurants/:id/menu
    }
    
    class CourierController {
        +POST /couriers/:id/orders/:orderId/accept
        +PUT /couriers/:id/orders/:orderId/status
        +GET /couriers/:id/orders
        +PUT /couriers/:id/location
    }
    
    class OrderController {
        +GET /orders/:id
        +PUT /orders/:id/status
        +GET /orders
        +POST /orders
    }

    %% Services (Camada de Neg√≥cio)
    class CustomerService {
        +placeOrder(Customer, OrderRequest) Order
        +listOrders(Long customerId) List~Order~
        +updateProfile(Long customerId, ProfileUpdateRequest) Customer
        +getProfile(Long customerId) Customer
    }
    
    class RestaurantService {
        +getMenu(Long restaurantId) List~MenuItem~
        +acknowledgeOrder(Long orderId) Order
        +listOrders(Long restaurantId) List~Order~
        +updateMenu(Long restaurantId, MenuUpdateRequest) void
    }
    
    class CourierService {
        +acceptDelivery(Long orderId, Long courierId) Order
        +updateOrderStatus(Long orderId, OrderStatus) Order
        +listAssignedOrders(Long courierId) List~Order~
        +updateLocation(Long courierId, Location) void
    }
    
    class OrderService {
        +getById(Long id) Order
        +updateStatus(Long id, OrderStatus) Order
        +listOrders(OrderFilter filter) List~Order~
        +createOrder(OrderRequest) Order
    }
    
    %% Classe "Order" central para apontar rela√ß√µes
    class Order

    %% Relacionamentos
    CustomerController --> CustomerService : uses
    RestaurantController --> RestaurantService : uses
    
    CourierController --> CourierService : uses
    OrderController --> OrderService : uses
    
    CustomerService --> Order : manages
    RestaurantService --> Order : processes
    
    CourierService --> Order : delivers
    OrderService --> Order : manages

    %% For√ßar CourierController e CourierService abaixo
    CustomerService --> CustomerController : related
    RestaurantService --> RestaurantController : related

    %% For√ßar CourierController e CourierService abaixo de Order
    Order --> CourierController : triggers
    Order --> CourierService : triggers

    %% For√ßar OrderController e OrderService abaixo de Order
    Order --> OrderController : triggers
    Order --> OrderService : triggers

```

### üîç **Explica√ß√£o da Arquitetura:**
- **Controllers**: Recebem requisi√ß√µes HTTP e delegam para Services
- **Services**: Cont√™m toda a l√≥gica de neg√≥cio e valida√ß√µes
- **Separa√ß√£o de Responsabilidades**: Cada camada tem uma fun√ß√£o espec√≠fica

---

## 3Ô∏è‚É£ **DTOs e Mappers (Transfer√™ncia de Dados)**

### üìä Estrutura de DTOs e Mappers
```mermaid
classDiagram
    title DTOs e Mappers Padrao de Transferencia de Dados
    
    %% DTOs de Entrada (Requests)
    class CustomerCreateRequest {
        +String name
        +String email
        +String password
        +String phone
        +String address
    }
    
    class OrderCreateRequest {
        +Long restaurantId
        +List~OrderItemRequest~ items
        +String deliveryAddress
        +String notes
    }
    
    class OrderStatusUpdateRequest {
        +OrderStatus status
        +String reason
        +String notes
    }

```
```mermaid
classDiagram
    %% DTOs de Sa√≠da (Responses)
    class CustomerDTO {
        +Long id
        +String name
        +String email
        +String phone
        +String address
        +LocalDateTime createdAt
    }
    
    class RestaurantDTO {
        +Long id
        +String name
        +String description
        +String address
        +String phone
        +Boolean isActive
        +List~MenuItemDTO~ menu
    }
    
    %% Mappers
    class CustomerMapper {
        +toDTO(Customer) CustomerDTO
        +toEntity(CustomerCreateRequest) Customer
        +updateEntity(Customer, CustomerUpdateRequest) Customer
    }
    
    class RestaurantMapper {
        +toDTO(Restaurant) RestaurantDTO
        +toEntity(RestaurantCreateRequest) Restaurant
        +updateEntity(Restaurant, RestaurantUpdateRequest) Restaurant
    }
    

    %% Relacionamentos
    CustomerMapper --> Customer : converts
    CustomerMapper --> CustomerDTO : converts
    RestaurantMapper --> Restaurant : converts
    RestaurantMapper --> RestaurantDTO : converts
```

```mermaid
classDiagram
    %% DTOs de Sa√≠da (Responses)
    class CourierDTO {
        +Long id
        +String name
        +String vehicle
        +String licensePlate
        +CourierStatus status
        +Location currentLocation
    }
    
    class OrderDTO {
        +Long id
        +OrderStatus status
        +BigDecimal totalAmount
        +LocalDateTime createdAt
        +LocalDateTime estimatedDelivery
        +CustomerDTO customer
        +RestaurantDTO restaurant
        +CourierDTO courier
        +List~OrderItemDTO~ items
    }

    %% Mappers
    class CourierMapper {
        +toDTO(Courier) CourierDTO
        +toEntity(CourierCreateRequest) Courier
        +updateEntity(Courier, CourierUpdateRequest) Courier
    }
    
    class OrderMapper {
        +toDTO(Order) OrderDTO
        +toEntity(OrderCreateRequest) Order
        +updateEntity(Order, OrderStatusUpdateRequest) Order
    }
    %% Relacionamentos
    CourierMapper --> Courier : converts
    CourierMapper --> CourierDTO : converts
    OrderMapper --> Order : converts
    OrderMapper --> OrderDTO : converts

````

### üîç **Explica√ß√£o dos DTOs:**
- **Request DTOs**: Dados de entrada para cria√ß√£o/atualiza√ß√£o
- **Response DTOs**: Dados de sa√≠da para o cliente
- **Mappers**: Convertem entre entidades e DTOs, mantendo separa√ß√£o de camadas

---

## 4Ô∏è‚É£ **Camada de Apresenta√ß√£o (Views)**

### üìä Estrutura de Views
```mermaid
classDiagram
    title Camada de Apresentacao - Views
    
    %% Views para diferentes tipos de usu√°rio
    class CustomerView {
        +showProfile(CustomerDTO) String
        +showOrders(List~OrderDTO~) String
        +showOrderDetails(OrderDTO) String
        +showRestaurantMenu(List~MenuItemDTO~) String
    }
    
    class RestaurantView {
        +showMenu(List~MenuItemDTO~) String
        +showIncomingOrders(List~OrderDTO~) String
        +showOrderDetails(OrderDTO) String
        +showAnalytics(RestaurantAnalytics) String
    }

    %% Relacionamentos com Controllers
    CustomerController ..> CustomerView : uses
    RestaurantController ..> RestaurantView : uses

```
```mermaid
classDiagram
    class CourierView {
        +showAssignedOrders(List~OrderDTO~) String
        +showOrderDetails(OrderDTO) String
        +showDeliveryRoute(List~OrderDTO~) String
        +showEarnings(CourierEarnings) String
    }
    
    class OrderView {
        +showOrderDetails(OrderDTO) String
        +showOrderStatus(OrderDTO) String
        +showOrderHistory(List~OrderDTO~) String
        +showTrackingInfo(OrderDTO) String
    }

    %% Relacionamentos com Controllers
    CourierController ..> CourierView : uses
    OrderController ..> OrderView : uses
```

### üîç **Explica√ß√£o das Views:**
- **CustomerView**: Interface para clientes visualizarem pedidos e perfil
- **RestaurantView**: Interface para restaurantes gerenciarem pedidos e menu
- **CourierView**: Interface para entregadores acompanharem entregas
- **OrderView**: Interface gen√©rica para visualiza√ß√£o de pedidos

---

## 5Ô∏è‚É£ **Camada de Persist√™ncia (Repositories)**

### üìä Estrutura de Repositories
```mermaid
classDiagram
    title Camada de Persist√™ncia - Repositories
    
    %% Repositories para cada entidade
    class CustomerRepository {
        +findById(Long id) Optional~Customer~
        +findByEmail(String email) Optional~Customer~
        +findAll() List~Customer~
        +save(Customer customer) Customer
        +deleteById(Long id) void
        +existsByEmail(String email) boolean
    }
    
    class RestaurantRepository {
        +findById(Long id) Optional~Restaurant~
        +findByTaxId(String taxId) Optional~Restaurant~
        +findByCity(String city) List~Restaurant~
        +findActiveRestaurants() List~Restaurant~
        +save(Restaurant restaurant) Restaurant
        +deleteById(Long id) void
    }
    


    %% Relacionamentos com entidades
    CustomerRepository --> Customer : manages
    RestaurantRepository --> Restaurant : manages
```
```mermaid
classDiagram
    title Camada de Persist√™ncia - Repositories
    
    %% Repositories para cada entidade
    class CourierRepository {
        +findById(Long id) Optional~Courier~
        +findByVehicle(String vehicle) List~Courier~
        +findAvailableCouriers() List~Courier~
        +findByStatus(CourierStatus status) List~Courier~
        +save(Courier courier) Courier
        +deleteById(Long id) void
    }
    
    class OrderRepository {
        +findById(Long id) Optional~Order~
        +findByCustomerId(Long customerId) List~Order~
        +findByRestaurantId(Long restaurantId) List~Order~
        +findByCourierId(Long courierId) List~Order~
        +findByStatus(OrderStatus status) List~Order~
        +save(Order order) Order
        +deleteById(Long id) void
    }

    CourierRepository --> Courier : manages
    OrderRepository --> Order : manages
```

### üîç **Explica√ß√£o dos Repositories:**
- **CustomerRepository**: Gerencia persist√™ncia de clientes
- **RestaurantRepository**: Gerencia persist√™ncia de restaurantes
- **CourierRepository**: Gerencia persist√™ncia de entregadores
- **OrderRepository**: Gerencia persist√™ncia de pedidos

---

## 6Ô∏è‚É£ **Fluxo de Dados Completo**

### üìä Fluxo de uma Requisi√ß√£o
```mermaid
sequenceDiagram
    title Fluxo Completo de uma Requisi√ß√£o de Pedido
    
    participant Client as Cliente
    participant Controller as CustomerController
    participant Service as CustomerService
    participant Repository as CustomerRepository
    participant OrderService as OrderService
    participant OrderRepo as OrderRepository
    participant DB as Database
    
    Client->>Controller: POST /customers/{id}/orders
    Controller->>Service: placeOrder(customerId, orderRequest)
    Service->>Repository: findById(customerId)
    Repository->>DB: SELECT * FROM customers WHERE id = ?
    DB-->>Repository: Customer data
    Repository-->>Service: Customer entity
    Service->>OrderService: createOrder(orderRequest)
    OrderService->>OrderRepo: save(order)
    OrderRepo->>DB: INSERT INTO orders (...)
    DB-->>OrderRepo: Order with ID
    OrderRepo-->>OrderService: Order entity
    OrderService-->>Service: Order entity
    Service-->>Controller: Order entity
    Controller-->>Client: OrderDTO (201 Created)
```

---

## 7Ô∏è‚É£ **Padr√µes e Boas Pr√°ticas Utilizados**

### ‚úÖ **Padr√µes de Projeto:**
- **MVC (Model-View-Controller)**: Separa√ß√£o clara de responsabilidades
- **Repository Pattern**: Abstra√ß√£o da camada de dados
- **Service Layer Pattern**: L√≥gica de neg√≥cio centralizada
- **DTO Pattern**: Transfer√™ncia segura de dados entre camadas
- **Mapper Pattern**: Convers√£o entre entidades e DTOs

### ‚úÖ **Princ√≠pios SOLID:**
- **Single Responsibility**: Cada classe tem uma responsabilidade
- **Open/Closed**: Extens√≠vel sem modifica√ß√£o
- **Liskov Substitution**: Heran√ßa bem implementada
- **Interface Segregation**: Interfaces espec√≠ficas para cada necessidade
- **Dependency Inversion**: Depend√™ncias atrav√©s de abstra√ß√µes

### ‚úÖ **Estrutura de Pacotes Recomendada:**
```
com.deliverytech.delivery/
‚îú‚îÄ‚îÄ controller/          # Controladores REST
‚îú‚îÄ‚îÄ service/            # L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ repository/         # Acesso a dados
‚îú‚îÄ‚îÄ model/             # Entidades JPA
‚îú‚îÄ‚îÄ dto/               # Objetos de transfer√™ncia
‚îú‚îÄ‚îÄ mapper/            # Conversores
‚îú‚îÄ‚îÄ config/            # Configura√ß√µes
‚îú‚îÄ‚îÄ exception/         # Exce√ß√µes customizadas
‚îî‚îÄ‚îÄ util/              # Utilit√°rios
```

---

## üéØ **Pr√≥ximos Passos para Implementa√ß√£o:**

1. **Configurar projeto Spring Boot** com depend√™ncias necess√°rias
2. **Implementar entidades JPA** com anota√ß√µes apropriadas
3. **Criar repositories** com Spring Data JPA
4. **Implementar services** com l√≥gica de neg√≥cio
5. **Criar controllers REST** com endpoints documentados
6. **Implementar DTOs e mappers** para transfer√™ncia de dados
7. **Adicionar valida√ß√µes** e tratamento de exce√ß√µes
8. **Configurar banco de dados** e migrations
9. **Implementar testes unit√°rios** e de integra√ß√£o
10. **Documentar API** com Swagger/OpenAPI

---

*üìù Este diagrama serve como base para implementa√ß√£o de uma API de delivery robusta e escal√°vel.*